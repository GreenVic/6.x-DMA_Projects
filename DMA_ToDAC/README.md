# DMA_ToDAC
Пример выводит сигнал в ЦАП посредством DMA по отсчетам таймера.

Помимо вывода сигнала, проект показывает, что для работы с DMA необходимо включать тактирование всех блоков SSP. Если этого не сделать, то прерывания DMA начинают генерироваться постоянно, еще до инициализации таймера и разрешения ему работать на DMA. При этом основная ветвь перестает исполняться, что демонстрируют два светодиода.

Оба светодиода зажигаются при старте инициализации и выключаются при окончании инициализации. Далее в основном цикле мигает только один светодиод, показывая что исполнение проходит штатно. При этом на выходе ЦАП осциллографом можно увидеть выводимый сигнал синуса. (Сигнал можно поменять если выбрать другую функцию рассчета сигнала в коде)

Баг активируется макроопределением BUG_SSPx_ACTIVATE. При этом загораются оба светодиода и останутся гореть, т.к. цикл инициализации прерывается непрерывными прерываниями от SSP.

Баг связан с тем, что при включении МК со стороны SSP к NVIC стоит активный сигнал запроса прерывания. При разрешении тактирования SSP этот сигнал запроса приходит в состояние, согласованное с регистром SSP в котором запрос на прерывание по умолчанию выключен. Поэтому включение тактирования SSP помогает избавиться от лишних прерываний от DMA.

## Timer to DMA
При использовании таймера с DMA необходимо учитывать, что таймер
  - в 1986ВЕ9х вырабатывает только sreg (одиночный) запрос к DMA. Поэтому количество передач до арбитража можно ставить любое - DMA выводит по одному значению на событие таймера.
  - в 1986ВЕ1 вырабатываются sreq и req запросы к таймеру. В регистре CHNL_USEBURST_(set/get) можно отключить только sreq. Поэтому количество значений до арбитража необходимо ставить 1. В противном случае выведется все количество данных по одному событию от таймера.

Описание проекта статье - https://startmilandr.ru/doku.php/prog:dma:dma_todac